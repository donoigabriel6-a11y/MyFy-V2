<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>MyFy ‚Äì YouTube Music Player</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

  <!-- YouTube IFrame Player API -->
  <script src="https://www.youtube.com/iframe_api"></script>

  <style>
    :root {
      --bg-main: #0b0b0b;
      --bg-elevated: #181818;
      --bg-hover: #262626;
      --accent: #ff0000;
      --text-primary: #ffffff;
      --text-secondary: #b3b3b3;
      --border-subtle: #2a2a2a;
      --radius-lg: 12px;
    }

    * { box-sizing: border-box; }

    body {
      margin: 0;
      font-family: "Inter", system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: var(--bg-main);
      color: var(--text-primary);
      overflow: hidden;
    }

    a { color: inherit; text-decoration: none; }

    .app {
      display: grid;
      grid-template-rows: auto 1fr auto;
      height: 100vh;
      background:
        radial-gradient(circle at top left, #ff000022 0, transparent 55%),
        radial-gradient(circle at bottom right, #ff000022 0, transparent 55%),
        var(--bg-main);
    }

    /* TOP NAV */
    .top-nav {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 12px 20px;
      background: rgba(0,0,0,0.9);
      border-bottom: 1px solid #000;
      backdrop-filter: blur(10px);
      z-index: 10;
    }

    .top-nav-left {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .logo-dot {
      width: 32px;
      height: 32px;
      border-radius: 50%;
      background: radial-gradient(circle at 30% 30%, #ffb3b3, #ff0000);
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 800;
      font-size: 18px;
      color: #000;
    }

    .brand-name {
      font-weight: 700;
      letter-spacing: 0.05em;
      font-size: 18px;
    }

    .top-nav-right {
      display: flex;
      align-items: center;
      gap: 10px;
      flex-wrap: wrap;
      justify-content: flex-end;
    }

    .search-bar {
      display: flex;
      align-items: center;
      gap: 8px;
      background: rgba(24,24,24,0.9);
      border-radius: 999px;
      padding: 4px 10px 4px 12px;
      border: 1px solid var(--border-subtle);
    }

    .search-bar input {
      border: none;
      outline: none;
      background: transparent;
      color: var(--text-primary);
      font-size: 13px;
      width: 220px;
    }

    .search-bar input::placeholder {
      color: var(--text-secondary);
    }

    .pill-btn {
      border-radius: 999px;
      border: 0;
      padding: 7px 16px;
      font-size: 13px;
      font-weight: 600;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      transition: transform 0.12s ease-out, box-shadow 0.12s ease-out, filter 0.12s ease-out;
    }

    .pill-btn--solid {
      background: var(--accent);
      color: #000;
    }

    .pill-btn--solid:hover {
      filter: brightness(1.05);
      transform: translateY(-1px);
      box-shadow: 0 4px 16px rgba(0,0,0,0.5);
    }

    /* MAIN */
    .main {
      padding: 16px 20px 20px;
      overflow-y: auto;
    }

    .hero {
      margin-bottom: 24px;
      display: flex;
      flex-direction: column;
      gap: 6px;
    }

    .hero-title {
      font-size: 26px;
      font-weight: 800;
    }

    .hero-subtitle {
      font-size: 14px;
      color: var(--text-secondary);
      max-width: 520px;
    }

    .tags-row {
      margin-top: 10px;
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
    }

    .tag-btn {
      border-radius: 999px;
      border: 1px solid var(--border-subtle);
      font-size: 12px;
      padding: 4px 10px;
      background: rgba(0,0,0,0.5);
      color: var(--text-secondary);
      cursor: pointer;
      transition: background 0.12s ease-out, color 0.12s ease-out, border-color 0.12s ease-out;
    }

    .tag-btn:hover {
      background: var(--bg-hover);
      color: var(--text-primary);
      border-color: var(--text-secondary);
    }

    .section-header {
      display: flex;
      align-items: baseline;
      justify-content: space-between;
      gap: 8px;
      margin-bottom: 12px;
    }

    .section-title {
      font-size: 20px;
      font-weight: 700;
    }

    .section-subtitle {
      font-size: 13px;
      color: var(--text-secondary);
    }

    .card-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(170px, 1fr));
      gap: 14px;
    }

    .card {
      background: rgba(36,36,36,0.9);
      border-radius: 10px;
      padding: 10px;
      cursor: pointer;
      position: relative;
      overflow: hidden;
      transition: background 0.12s ease-out, transform 0.12s ease-out, box-shadow 0.12s ease-out;
    }

    .card:hover {
      background: var(--bg-hover);
      transform: translateY(-2px);
      box-shadow: 0 10px 24px rgba(0,0,0,0.7);
    }

    .card-thumb {
      border-radius: 8px;
      margin-bottom: 8px;
      overflow: hidden;
      position: relative;
      aspect-ratio: 16 / 9;
      background: #000;
    }

    .card-thumb img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      display: block;
    }

    .card-title {
      font-size: 14px;
      font-weight: 600;
      margin-bottom: 2px;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .card-desc {
      font-size: 12px;
      color: var(--text-secondary);
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .card-play-btn {
      position: absolute;
      right: 14px;
      bottom: 14px;
      width: 36px;
      height: 36px;
      border-radius: 50%;
      background: #ff0000;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 8px 22px rgba(0,0,0,0.7);
      opacity: 0;
      transform: translateY(10px);
      transition: opacity 0.12s ease-out, transform 0.12s ease-out;
    }

    .card:hover .card-play-btn {
      opacity: 1;
      transform: translateY(0);
    }

    .card-play-btn svg {
      width: 16px;
      height: 16px;
      fill: #fff;
    }

    /* PLAYER BAR */
    .player-bar {
      display: grid;
      grid-template-columns: 280px 1fr 240px;
      align-items: center;
      padding: 8px 16px;
      background: #181818;
      border-top: 1px solid #000;
      gap: 12px;
    }

    .player-now {
      display: flex;
      align-items: center;
      gap: 10px;
      min-width: 0;
    }

    .player-thumb {
      width: 48px;
      height: 48px;
      border-radius: 4px;
      background: linear-gradient(135deg, #ff0000 0%, #f97316 50%, #a855f7 100%);
      overflow: hidden;
    }

    .player-thumb img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      display: block;
    }

    .player-track-meta {
      display: flex;
      flex-direction: column;
      gap: 3px;
      min-width: 0;
    }

    .player-track-title {
      font-size: 13px;
      font-weight: 600;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .player-track-artist {
      font-size: 12px;
      color: var(--text-secondary);
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .player-center {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 6px;
    }

    .player-controls {
      display: flex;
      align-items: center;
      gap: 14px;
      font-size: 18px;
      color: var(--text-secondary);
    }

    .player-control-btn {
      cursor: pointer;
      transition: color 0.1s ease-out, transform 0.1s ease-out;
    }

    .player-control-btn:hover {
      color: var(--text-primary);
      transform: translateY(-1px);
    }

    .player-control-btn.play {
      background: var(--accent);
      color: #fff;
      border-radius: 999px;
      width: 32px;
      height: 32px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 16px;
      box-shadow: 0 6px 22px rgba(0,0,0,0.6);
    }

    .player-progress-row {
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 11px;
      color: var(--text-secondary);
      width: 100%;
      max-width: 540px;
    }

    .progress-track {
      flex: 1;
      height: 4px;
      border-radius: 999px;
      background: #404040;
      position: relative;
      overflow: hidden;
      cursor: pointer;
    }

    .progress-fill {
      position: absolute;
      inset: 0;
      width: 0%;
      background: linear-gradient(90deg, var(--accent), #f97316);
      border-radius: 999px;
    }

    .player-right {
      display: flex;
      align-items: center;
      justify-content: flex-end;
      gap: 12px;
      font-size: 14px;
      color: var(--text-secondary);
    }

    .volume-track {
      width: 90px;
      height: 4px;
      border-radius: 999px;
      background: #404040;
      position: relative;
      overflow: hidden;
      cursor: pointer;
    }

    .volume-fill {
      position: absolute;
      inset: 0;
      width: 70%;
      border-radius: 999px;
      background: #e5e5e5;
    }

    @media (max-width: 900px) {
      .player-bar {
        grid-template-columns: minmax(0, 1fr);
        grid-auto-rows: auto;
        row-gap: 8px;
      }
      .player-right { justify-content: center; }
    }

    @media (max-width: 650px) {
      .search-bar input { width: 140px; }
    }

    /* Hidden player container */
    #ytPlayerWrapper {
      position: fixed;
      inset: auto auto 80px 20px;
      width: 320px;
      height: 0;
      opacity: 0;
      pointer-events: none;
    }
  </style>
</head>
<body>
  <div class="app">
    <!-- TOP NAV -->
    <header class="top-nav">
      <div class="top-nav-left">
        <div class="logo-dot">‚ñ∂</div>
        <div class="brand-name">MyFy</div>
      </div>
      <div class="top-nav-right">
        <form id="searchForm" class="search-bar">
          <span>üîç</span>
          <input id="searchInput" type="text" placeholder="Search songs or artists on YouTube..." />
          <button type="submit" class="pill-btn pill-btn--solid">Search</button>
        </form>
      </div>
    </header>

    <!-- MAIN -->
    <main class="main">
      <section class="hero">
        <div class="hero-title">YouTube-powered music search</div>
        <div class="hero-subtitle">
          Type an artist, song, or vibe. We‚Äôll search YouTube using its API and play full videos using the official YouTube player.
        </div>
        <div class="tags-row">
          <button class="tag-btn">lofi hip hop</button>
          <button class="tag-btn">phonk</button>
          <button class="tag-btn">drake</button>
          <button class="tag-btn">d4vd</button>
          <button class="tag-btn">study beats</button>
          <button class="tag-btn">gaming music</button>
        </div>
      </section>

      <section>
        <div class="section-header">
          <div class="section-title">Results</div>
          <div class="section-subtitle" id="resultsSubtitle">
            Try a search like <strong>lofi hip hop</strong> or click one of the tags above.
          </div>
        </div>
        <div class="card-grid" id="resultsGrid"></div>
      </section>
    </main>

    <!-- PLAYER BAR -->
    <footer class="player-bar">
      <div class="player-now">
        <div class="player-thumb" id="playerThumb"></div>
        <div class="player-track-meta">
          <div class="player-track-title" id="playerTrackTitle">Nothing playing yet</div>
          <div class="player-track-artist" id="playerTrackArtist">Search YouTube to get started</div>
        </div>
      </div>

      <div class="player-center">
        <div class="player-controls">
          <div class="player-control-btn" id="prevBtn">‚èÆ</div>
          <div class="player-control-btn play" id="playToggleBtn">‚ñ∂</div>
          <div class="player-control-btn" id="nextBtn">‚è≠</div>
        </div>
        <div class="player-progress-row">
          <span id="currentTime">0:00</span>
          <div class="progress-track" id="progressTrack">
            <div class="progress-fill" id="progressFill"></div>
          </div>
          <span id="duration">0:00</span>
        </div>
      </div>

      <div class="player-right">
        <span>üîä</span>
        <div class="volume-track" id="volumeTrack">
          <div class="volume-fill" id="volumeFill"></div>
        </div>
      </div>
    </footer>
  </div>

  <!-- Hidden YouTube player (sound comes from here) -->
  <div id="ytPlayerWrapper">
    <div id="ytPlayer"></div>
  </div>

  <script>
    // ========= CONFIG =========
    // TODO: put your own YouTube Data API key here
    const YT_API_KEY = "AIzaSyCAI5uYDCGWGP_2NyUpkzTe4B-FzO0wmPo";

    // ========= STATE =========
    let ytApiReady = false;
    let player = null;
    let tracks = [];   // { videoId, title, channel, thumb }
    let currentIndex = -1;
    let timeTimer = null;

    // ========= DOM =========
    const searchForm = document.getElementById("searchForm");
    const searchInput = document.getElementById("searchInput");
    const resultsGrid = document.getElementById("resultsGrid");
    const resultsSubtitle = document.getElementById("resultsSubtitle");
    const tagButtons = document.querySelectorAll(".tag-btn");

    const playerThumb = document.getElementById("playerThumb");
    const playerTrackTitle = document.getElementById("playerTrackTitle");
    const playerTrackArtist = document.getElementById("playerTrackArtist");

    const playToggleBtn = document.getElementById("playToggleBtn");
    const prevBtn = document.getElementById("prevBtn");
    const nextBtn = document.getElementById("nextBtn");

    const progressTrack = document.getElementById("progressTrack");
    const progressFill = document.getElementById("progressFill");
    const currentTimeLabel = document.getElementById("currentTime");
    const durationLabel = document.getElementById("duration");

    const volumeTrack = document.getElementById("volumeTrack");
    const volumeFill = document.getElementById("volumeFill");

    // ========= UTILS =========
    function formatTime(seconds) {
      if (!seconds || !isFinite(seconds)) return "0:00";
      const mins = Math.floor(seconds / 60);
      const secs = Math.floor(seconds % 60);
      const padded = secs < 10 ? "0" + secs : secs;
      return `${mins}:${padded}`;
    }

    function clearTimeTimer() {
      if (timeTimer) {
        clearInterval(timeTimer);
        timeTimer = null;
      }
    }

    function startTimeTimer() {
      clearTimeTimer();
      timeTimer = setInterval(() => {
        if (!player || typeof player.getDuration !== "function") return;
        const total = player.getDuration();
        const cur = player.getCurrentTime();
        if (!total || !isFinite(total)) return;
        progressFill.style.width = `${(cur / total) * 100}%`;
        currentTimeLabel.textContent = formatTime(cur);
        durationLabel.textContent = formatTime(total);
      }, 500);
    }

    function setVolumeFromRatio(ratio) {
      const vol = Math.max(0, Math.min(1, ratio));
      volumeFill.style.width = `${vol * 100}%`;
      if (player && typeof player.setVolume === "function") {
        player.setVolume(vol * 100); // YouTube uses 0‚Äì100
      }
    }

    // ========= YOUTUBE IFRAME API =========
    function createPlayer(videoId) {
      player = new YT.Player("ytPlayer", {
        videoId,
        playerVars: {
          autoplay: 1,
          rel: 0,
          modestbranding: 1
        },
        events: {
          onReady: () => {
            setVolumeFromRatio(0.7);
          },
          onStateChange: (event) => {
            if (event.data === YT.PlayerState.PLAYING) {
              playToggleBtn.textContent = "‚è∏";
              startTimeTimer();
            } else if (
              event.data === YT.PlayerState.PAUSED ||
              event.data === YT.PlayerState.ENDED
            ) {
              playToggleBtn.textContent = "‚ñ∂";
              if (event.data === YT.PlayerState.ENDED) {
                clearTimeTimer();
                progressFill.style.width = "0%";
              }
            }
          }
        }
      });
    }

    window.onYouTubeIframeAPIReady = function () {
      ytApiReady = true;
    };

    // ========= RENDER RESULTS =========
    function renderResults(list) {
      resultsGrid.innerHTML = "";
      tracks = list || [];
      currentIndex = -1;

      if (!tracks.length) {
        resultsSubtitle.textContent = "No results found. Try another search.";
        return;
      }

      resultsSubtitle.innerHTML = `Found <strong>${tracks.length}</strong> results on YouTube.`;

      tracks.forEach((track, index) => {
        const card = document.createElement("article");
        card.className = "card";
        card.dataset.index = index;

        const thumbDiv = document.createElement("div");
        thumbDiv.className = "card-thumb";

        const img = document.createElement("img");
        img.src = track.thumb;
        img.alt = track.title;
        thumbDiv.appendChild(img);

        const titleDiv = document.createElement("div");
        titleDiv.className = "card-title";
        titleDiv.textContent = track.title;

        const descDiv = document.createElement("div");
        descDiv.className = "card-desc";
        descDiv.textContent = track.channel;

        const playBtn = document.createElement("button");
        playBtn.className = "card-play-btn";
        playBtn.setAttribute("aria-label", "Play");
        playBtn.innerHTML = `
          <svg viewBox="0 0 24 24">
            <path d="M8 5v14l11-7z"></path>
          </svg>
        `;

        card.appendChild(thumbDiv);
        card.appendChild(titleDiv);
        card.appendChild(descDiv);
        card.appendChild(playBtn);

        card.addEventListener("click", () => playFromIndex(index));

        resultsGrid.appendChild(card);
      });
    }

    // ========= PLAYBACK =========
    function updateNowPlayingUI(track) {
      playerTrackTitle.textContent = track.title;
      playerTrackArtist.textContent = track.channel;
      playerThumb.innerHTML = `<img src="${track.thumb}" alt="${track.title}">`;
    }

    function playFromIndex(index) {
      if (!tracks.length || index < 0 || index >= tracks.length) return;
      const track = tracks[index];
      currentIndex = index;
      updateNowPlayingUI(track);

      if (!ytApiReady) {
        alert("YouTube API is still loading. Try again in a second.");
        return;
      }

      if (!player) {
        createPlayer(track.videoId);
      } else {
        player.loadVideoById(track.videoId);
      }

      startTimeTimer();
    }

    function togglePlayPause() {
      if (!player) {
        if (tracks.length) playFromIndex(0);
        else alert("Search and pick a video first.");
        return;
      }
      const state = player.getPlayerState();
      if (state === YT.PlayerState.PLAYING) {
        player.pauseVideo();
      } else {
        player.playVideo();
      }
    }

    function playNext() {
      if (!tracks.length) return;
      const nextIndex = currentIndex >= tracks.length - 1 ? 0 : currentIndex + 1;
      playFromIndex(nextIndex);
    }

    function playPrev() {
      if (!tracks.length) return;
      const prevIndex = currentIndex <= 0 ? tracks.length - 1 : currentIndex - 1;
      playFromIndex(prevIndex);
    }

    // ========= SEARCH =========
    async function searchYouTube(term) {
      if (!YT_API_KEY || YT_API_KEY === "YOUR_YOUTUBE_API_KEY_HERE") {
        alert("You must put your YouTube API key into the code first.");
        return;
      }

      resultsSubtitle.textContent = "Searching YouTube‚Ä¶";

      const url =
        "https://www.googleapis.com/youtube/v3/search" +
        `?part=snippet&type=video&maxResults=24&q=${encodeURIComponent(term)}&key=${encodeURIComponent(
          YT_API_KEY
        )}`;

      try {
        const res = await fetch(url);
        const data = await res.json();

        if (data.error) {
          console.error("YouTube API error:", data.error);
          resultsSubtitle.textContent = data.error.message || "YouTube API error.";
          return;
        }

        const list = (data.items || []).map((item) => ({
          videoId: item.id.videoId,
          title: item.snippet.title,
          channel: item.snippet.channelTitle,
          thumb: item.snippet.thumbnails?.medium?.url || item.snippet.thumbnails?.default?.url
        }));

        renderResults(list);
      } catch (err) {
        console.error("YouTube fetch error:", err);
        resultsSubtitle.textContent = "Network error talking to YouTube.";
      }
    }

    searchForm.addEventListener("submit", (e) => {
      e.preventDefault();
      const term = searchInput.value.trim();
      if (!term) return;
      searchYouTube(term);
    });

    tagButtons.forEach((btn) => {
      btn.addEventListener("click", () => {
        const term = btn.textContent.trim();
        searchInput.value = term;
        searchYouTube(term);
      });
    });

    // ========= PLAYER CONTROLS =========
    playToggleBtn.addEventListener("click", togglePlayPause);
    nextBtn.addEventListener("click", playNext);
    prevBtn.addEventListener("click", playPrev);

    progressTrack.addEventListener("click", (event) => {
      if (!player || typeof player.getDuration !== "function") return;
      const total = player.getDuration();
      if (!total || !isFinite(total)) return;
      const rect = progressTrack.getBoundingClientRect();
      const ratio = (event.clientX - rect.left) / rect.width;
      const clamped = Math.max(0, Math.min(1, ratio));
      player.seekTo(total * clamped, true);
    });

    volumeTrack.addEventListener("click", (event) => {
      const rect = volumeTrack.getBoundingClientRect();
      const ratio = (event.clientX - rect.left) / rect.width;
      setVolumeFromRatio(ratio);
    });

    // default volume UI position
    setVolumeFromRatio(0.7);
  </script>
</body>
</html>
